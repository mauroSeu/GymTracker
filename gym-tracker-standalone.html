<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GymTracker Pro - Standalone</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    * { -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
    body { overscroll-behavior: none; -webkit-user-select: none; user-select: none; margin: 0; }
    input, textarea, button { -webkit-user-select: auto; user-select: auto; }
    @keyframes slideIn { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .animate-slideIn { animation: slideIn 0.3s ease-out; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1F2937; }
    ::-webkit-scrollbar-thumb { background: #4B5563; border-radius: 4px; }
    .version-badge {
      position: fixed; top: 10px; right: 10px; background: rgba(255,255,255,0.1); 
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px); padding: 8px 12px; border-radius: 8px; 
      font-size: 12px; color: white; z-index: 9999;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <div class="version-badge">
    üèãÔ∏è GymTracker Pro v3.0
  </div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { 
      ChevronLeft, ChevronRight, Dumbbell, Calendar, Target, Clock, 
      Play, Pause, SkipForward, SkipBack, Check, X, Timer, 
      TrendingUp, Video, Image: ImageIcon, Lightbulb, Zap, 
      Download, Menu, BarChart3, Activity, Award 
    } = lucide;

    const GymTracker = () => {
      const [currentDay, setCurrentDay] = useState(0);
      const [currentWeek, setCurrentWeek] = useState(1);
      const [completedSets, setCompletedSets] = useState({});
      const [customWeights, setCustomWeights] = useState({});
      const [playerMode, setPlayerMode] = useState(false);
      const [currentExercise, setCurrentExercise] = useState(0);
      const [currentSet, setCurrentSet] = useState(0);
      const [isResting, setIsResting] = useState(false);
      const [restTimer, setRestTimer] = useState(0);
      const [showSettings, setShowSettings] = useState(false);
      const [skippedDays, setSkippedDays] = useState({});
      const [editingWeight, setEditingWeight] = useState(null);
      const [exerciseNotes, setExerciseNotes] = useState({});
      const [personalRecords, setPersonalRecords] = useState({});
      const [workoutHistory, setWorkoutHistory] = useState([]);
      const [settings, setSettings] = useState({
        soundEnabled: true,
        vibrationEnabled: true,
        autoStartRest: true,
        defaultRestTime: null,
        theme: 'default'
      });
      
      const workoutDays = [
        {
          name: "Push (Petto/Spalle/Tricipiti)",
          shortName: "Push",
          color: "from-red-500 to-pink-500",
          icon: "üí™",
          exercises: [
            {
              name: "Panca Piana con Bilanciere",
              sets: 3,
              repsRange: "8-12",
              rest: "120-180 sec",
              focus: "Petto (Tensione Meccanica)",
              weeklyPlan: [
                { week: 1, sets: "3x8", weight: "15kg" },
                { week: 2, sets: "3x9", weight: "" },
                { week: 3, sets: "3x10", weight: "" },
                { week: 4, sets: "3x11", weight: "" },
                { week: 5, sets: "3x12", weight: "" }
              ]
            },
            {
              name: "Lat Machine Presa Larga",
              sets: 3,
              repsRange: "10-15",
              rest: "90-120 sec",
              focus: "Dorsali (Larghezza)",
              weeklyPlan: [
                { week: 1, sets: "3x10", weight: "45kg" },
                { week: 2, sets: "3x11", weight: "" },
                { week: 3, sets: "3x12", weight: "" },
                { week: 4, sets: "3x13", weight: "" },
                { week: 5, sets: "3x12", weight: "" }
              ]
            }
          ]
        },
        {
          name: "Pull (Schiena/Bicipiti)",
          shortName: "Pull",
          color: "from-blue-500 to-cyan-500",
          icon: "üéØ",
          exercises: [
            {
              name: "Stacco da Terra",
              sets: 3,
              repsRange: "6-10",
              rest: "180-240 sec",
              focus: "Catena Posteriore",
              weeklyPlan: [
                { week: 1, sets: "3x6", weight: "40kg" },
                { week: 2, sets: "3x7", weight: "" },
                { week: 3, sets: "3x8", weight: "" },
                { week: 4, sets: "3x9", weight: "" },
                { week: 5, sets: "3x10", weight: "" }
              ]
            }
          ]
        },
        {
          name: "Legs (Gambe Complete)",
          shortName: "Legs",
          color: "from-green-500 to-emerald-500",
          icon: "ü¶µ",
          exercises: [
            {
              name: "Squat con Bilanciere",
              sets: 4,
              repsRange: "6-10",
              rest: "180-240 sec",
              focus: "Quadricipiti + Glutei",
              weeklyPlan: [
                { week: 1, sets: "4x6", weight: "30kg" },
                { week: 2, sets: "4x7", weight: "" },
                { week: 3, sets: "4x8", weight: "" },
                { week: 4, sets: "4x9", weight: "" },
                { week: 5, sets: "4x10", weight: "" }
              ]
            }
          ]
        }
      ];

      const currentWorkout = workoutDays[currentDay];
      
      useEffect(() => {
        try {
          const saved = localStorage.getItem('gymTrackerData');
          if (saved) {
            const data = JSON.parse(saved);
            setCompletedSets(data.completedSets || {});
            setCustomWeights(data.customWeights || {});
            setSkippedDays(data.skippedDays || {});
            setExerciseNotes(data.exerciseNotes || {});
            setPersonalRecords(data.personalRecords || {});
            setWorkoutHistory(data.workoutHistory || []);
            setSettings(data.settings || settings);
            setCurrentWeek(data.currentWeek || 1);
            setCurrentDay(data.currentDay || 0);
          }
        } catch (e) { console.error(e); }
      }, []);

      useEffect(() => {
        try {
          localStorage.setItem('gymTrackerData', JSON.stringify({
            completedSets, customWeights, skippedDays, exerciseNotes,
            personalRecords, workoutHistory, settings, currentWeek, currentDay
          }));
        } catch (e) { console.error(e); }
      }, [completedSets, customWeights, skippedDays, exerciseNotes, personalRecords, workoutHistory, settings, currentWeek, currentDay]);

      const getSetKey = (exIdx, setIdx) => `${currentDay}-${currentWeek}-${exIdx}-${setIdx}`;
      const isSetCompleted = (exIdx, setIdx) => completedSets[getSetKey(exIdx, setIdx)] || false;
      
      const toggleSet = (exIdx, setIdx) => {
        const key = getSetKey(exIdx, setIdx);
        const newSets = { ...completedSets };
        if (newSets[key]) delete newSets[key];
        else newSets[key] = true;
        setCompletedSets(newSets);
        
        if (settings.vibrationEnabled && 'vibrate' in navigator) {
          navigator.vibrate(50);
        }
      };

      const getWeight = (exIdx) => {
        const key = `${currentDay}-${currentWeek}-${exIdx}`;
        return customWeights[key] || currentWorkout.exercises[exIdx].weeklyPlan[currentWeek - 1].weight;
      };

      const setWeight = (exIdx, weight) => {
        const key = `${currentDay}-${currentWeek}-${exIdx}`;
        setCustomWeights({ ...customWeights, [key]: weight });
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white p-4">
          <div className="max-w-4xl mx-auto">
            <div className="mb-6">
              <h1 className="text-3xl font-bold flex items-center gap-2 mb-4">
                <Dumbbell className="w-8 h-8" />
                GymTracker Pro
              </h1>

              <div className="bg-gray-800 rounded-xl p-4 flex items-center justify-between shadow-lg mb-4">
                <div className="flex items-center gap-2">
                  <Calendar className="w-5 h-5 text-blue-400" />
                  <span className="font-semibold">Settimana</span>
                </div>
                <div className="flex items-center gap-2">
                  <button
                    onClick={() => currentWeek > 1 && setCurrentWeek(currentWeek - 1)}
                    disabled={currentWeek === 1}
                    className="p-2 bg-gray-700 hover:bg-gray-600 disabled:opacity-30 rounded-lg"
                  >
                    <ChevronLeft className="w-4 h-4" />
                  </button>
                  <span className="text-2xl font-bold text-blue-400 min-w-[40px] text-center">
                    {currentWeek}
                  </span>
                  <button
                    onClick={() => currentWeek < 5 && setCurrentWeek(currentWeek + 1)}
                    disabled={currentWeek === 5}
                    className="p-2 bg-gray-700 hover:bg-gray-600 disabled:opacity-30 rounded-lg"
                  >
                    <ChevronRight className="w-4 h-4" />
                  </button>
                </div>
              </div>
            </div>

            <div className="mb-6">
              <div className="flex items-center gap-3 mb-3">
                <button
                  onClick={() => currentDay > 0 && setCurrentDay(currentDay - 1)}
                  disabled={currentDay === 0}
                  className="p-3 bg-gray-800 hover:bg-gray-700 disabled:opacity-30 rounded-xl"
                >
                  <ChevronLeft className="w-5 h-5" />
                </button>
                
                <div className="flex-1 bg-gradient-to-r from-gray-800 to-gray-700 rounded-xl p-4">
                  <div className="flex items-center gap-3">
                    <span className="text-4xl">{currentWorkout.icon}</span>
                    <div>
                      <h2 className="text-xl font-bold">{currentWorkout.shortName}</h2>
                      <p className="text-sm text-gray-400">{currentWorkout.name}</p>
                    </div>
                  </div>
                </div>
                
                <button
                  onClick={() => currentDay < workoutDays.length - 1 && setCurrentDay(currentDay + 1)}
                  disabled={currentDay === workoutDays.length - 1}
                  className="p-3 bg-gray-800 hover:bg-gray-700 disabled:opacity-30 rounded-xl"
                >
                  <ChevronRight className="w-5 h-5" />
                </button>
              </div>
            </div>

            <div className="space-y-4">
              {currentWorkout.exercises.map((exercise, exIdx) => {
                const plan = exercise.weeklyPlan[currentWeek - 1];
                const [sets, reps] = plan.sets.split('x');
                const totalSets = parseInt(sets);
                const currentWeight = getWeight(exIdx);
                
                return (
                  <div key={exIdx} className="bg-gray-800 rounded-xl p-4 shadow-lg">
                    <h3 className="font-bold text-lg mb-2">{exercise.name}</h3>
                    <p className="text-sm text-gray-400 mb-3">{exercise.focus}</p>

                    <div className="mb-3">
                      {editingWeight === exIdx ? (
                        <input
                          type="text"
                          value={currentWeight}
                          onChange={(e) => setWeight(exIdx, e.target.value)}
                          onBlur={() => setEditingWeight(null)}
                          className="w-full bg-gray-700 text-white px-3 py-2 rounded-lg"
                          placeholder="es. 20kg"
                          autoFocus
                        />
                      ) : (
                        <button
                          onClick={() => setEditingWeight(exIdx)}
                          className="w-full bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded-lg text-left"
                        >
                          <span className="text-gray-400 text-sm">Peso:</span>
                          <span className="ml-2 font-bold text-yellow-400">
                            {currentWeight || 'Non impostato'}
                          </span>
                        </button>
                      )}
                    </div>

                    <div className="flex flex-wrap gap-2 mb-2">
                      {Array.from({ length: totalSets }, (_, i) => (
                        <button
                          key={i}
                          onClick={() => toggleSet(exIdx, i)}
                          className={`flex-1 min-w-[60px] py-3 rounded-lg font-semibold transition-all ${
                            isSetCompleted(exIdx, i)
                              ? 'bg-green-500 hover:bg-green-600'
                              : 'bg-gray-700 hover:bg-gray-600'
                          }`}
                        >
                          Set {i + 1}
                          <div className="text-xs opacity-75">{reps} reps</div>
                        </button>
                      ))}
                    </div>

                    <div className="text-sm text-gray-400 flex items-center gap-2">
                      <Clock className="w-4 h-4" />
                      {exercise.rest}
                    </div>
                  </div>
                );
              })}
            </div>
            
            <div className="mt-6 text-center text-gray-500 text-sm">
              üí° Questa √® una versione standalone semplificata<br/>
              Per tutte le features (PWA, AI, Grafici), usa la versione completa con server locale
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<GymTracker />);
    lucide.createIcons();
  </script>
</body>
</html>
